<!DOCTYPE html PUBLIC "-//W3C//DTD html 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>pg_statsinfo</title>
<link rel="home" title="pg_statsinfo" href="index.html">
<link rel="stylesheet" TYPE="text/css"href="style.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body>
<div class="index">
<ol>
<li><a href="#name">What is pg_statsinfo?</a></li>
<li><a href="#description">Description</a></li>
<ol>
  <li><a href="#features-snapshot">Statistics Snapshot</a></li>
  <li><a href="#features-log">Server Log Filter</a></li>
  <li><a href="#features-alert">Alert Function</a></li>
  <li><a href="#features-cmdline">@コマンドライン機能</a></li>
  <li><a href="#features-maintenance">@自動メンテナンス機能</a></li>
</ol>
<li><a href="#install">Install</a>
<ol>
  <li><a href="#requirement">Rquirement</a></li>
  <li><a href="#procedure">Instlation</a></li>
</ol>
</li>
<li><a href="#usage">Usage</a></li>
<ol>
  <li><a href="#start-or-stop">Start or Stop</a></li>
  <li><a href="#snapshot">Get Snapshot</a></li>
  <li><a href="#log">Output of Logfile</a></li>
  <li><a href="#usage-alert">Alert Function</a></li>
  <li><a href="#usage-cmdline">@コマンドライン機能の使い方</a></li>
  <li><a href="#usage-maintenance">@自動メンテナンス機能の使い方</a></li>
  <li><a href="#configuration">Configuration</a></li>
  <li><a href="#user-operations">@運用上必要となる作業</a></li>
</ol>
<li><a href="#uninstall">Uninstall</a></li>
<li><a href="#restrictions">Restrictions</a></li>
<li><a href="#QA">Q&A</a></li>
<li><a href="#change">@pg_statsinfo 2.4 からの変更点</a></li>
<li><a href="#details">Details</a></li>
<ol>
  <li><a href="#many-instances">Multiple Instance and One Repository</a></li>
  <li><a href="#warm-standby">Warm Standby</a></li>
  <li><a href="#fallback-mode">@フォールバックモード</a></li>
  <li><a href="#internal">Internals</a></li>
</ol>
<li><a href="#seealso">See Also</a></li>
</ol>
</div>
<h1 id="pg_statsinfo">pg_statsinfo 2.5</h1>
<h2 id="name">What is pg_statsinfo ?</h2>
<p>pg_statsinfo -- monitor statistics and activities of PostgreSQL server.
It is easy to use pg_statsinfo that pg_statsinfo is working with PostgreSQL start or stop. 
</p>


<h2 id="description">Description</h2>
<p>pg_statsinfo monitors an instance of PostgreSQL server and gather the statistics and activities of the server as snapshots.
The snapshots will be stored in the same or another repository database.
It also parses PostgreSQL's CSV server log filesm and extracts performance logs from them.
Error messages are routed into textlog and syslog according to the message levels.</p>

<p>pg_statsinfo can be easily installed and maintained because it starts or stops automatically when PostgreSQL server starts or stops.
Also etting parameters are integrated with setting files of the server.
Statistics counters from pg_statsinfo can be displayed with <a href="http://pgstatsinfo.projects.postgresql.org/pg_stats_reporter.html">pg_stats_reporter</a> as graphical reports.</p>

<p>@pg_statsinfo のシステム構成例と動作概要のイメージ図を以下に示します。</p>

<div class="imagebox">
  <p class="image"><img src="image/system_structure.png"></p>
  <p class="caption">@図1: システム構成例</p>
</div>
<div class="imagebox">
  <p class="image"><img src="image/pg_statsinfo.png"></p>
  <p class="caption">@図2: 動作概要イメージ</p>
</div>
<p class="clear"/>

<h3 id="features-snapshot">Statistics Snapshot</h3>
<p>
pg_statsinfo gathers statistics periodically and stores them as snapshots into a repository database.
The repository can be in the same database with the monitored instance or in another instance.
Also, one repository can store snapshots from multiple monitored instances.
</p>

<ul>
  <li>Snapshots are gathered periodically (default: every 10 minites) or by manual.</li>
  <li>An event handler function is called after every snapshots taken.
      The function can be defined by users.
      A new snapshot can be compared with previous snapshots and raise alert messages in the function.
  </li>
</ul>

<p>Snapshot holds the following statistics information:</p>
<ul>
  <li>All of the information collected by <a href="http://developer.postgresql.org/pgdocs/postgres/monitoring-stats.html">the statistics collector</a>.
      For example, numbers of INSERT/UPDATE/DELETE and buffer access counters.</li>
  <li>Disk usages of each tablespace, pg_xlog, and archive log directory.</li>
  <li>Long transactions and their query strings.</li>
  <li>Process status in running, waiting for locks, idle in transaction, and idle.</li>
  <li>Output IO size of WAL.</li>
  <li>Number of checkpoint ,VACUUM execution time and access of buffers.</li>
  <li>SQLs and functions that take long time.</li>
  <li>PostgreSQL configuration parameters.</li>
  <li>@OS リソース情報 (CPU使用量、メモリ使用量、ディスクI/O、ロードアベレージ)。</li>
  <li>Lock infomation</li>
  <li>@リカバリとの競合によるクエリのキャンセル数</li>
  <li>State fo replication</li>
</ul>

<p>
Size of a snapshot depends on the numbers of objects in DB. There are about 600 - 800kB per snapshot.
In case of pg_statsinfo default settings, snapshots for each monitored DB requires 90 - 120MB per day.
</p>

<p>Note that pg_statsinfo doesn't delete old snapshots.
Please delete them manually.</p>

<h3 id="features-log">Server Log Filter</h3>
<ul>
  <li>Split server log lines according to the message levels.
      You can set different message threshold for csvlog, textlog, and syslog.</li>
  <li>Fix filename of the textlog.
      The default is $PGDATA/pg_log/pg_statsinfo.log.
      You can always read the latestlog in the same filename and setup of log monitoring tools would be easier.</li>
  <li>Set arbitrary access permission for each textlog files.
      You can control the default permission not only 600.</li>
  <li>@テキストログ、syslog に出力されるサーバログのメッセージレベルを任意のレベルに変更可能。例えば、オペレーションミスなどで発生する ERROR レベルのログを INFO レベルに変更して出力できます。</li>
  <li>@テキストログのフィルタリング設定。特定のユーザのサーバログをテキストログに出力しないようにすることができます。</li>
</ul>

<h3 id="features-alert">Alert Function</h3>
<p>
If database statistics is over threshold which was set by user, pg_statsinfo detect and write alert log in postgresql-log(message level is 'ALERT').
</p>

<p>
Alert function can set following alert parameter:
</p>
<ul>
  <li>Rollback / secounds </li>
  <li>Commit / secounds</li>
  <li>garbage data size (MB)</li>
  <li>garbage data size ratio(%)</li>
  <li>garbage data size ratio in each tables (%)</li>
  <li>average response time of queries (sec)</li>
  <li>longest response time of queries (sec)</li>
  <li>@各テーブルの断片化率(correlation) (%)</li>
  <li>@バックエンドの最大数</li>
  <li>@テーブルスペースのディスク空き容量 (%)</li>
  <li>@ロードアベレージ</li>
  <li>@スワップ使用量 (KB)</li>
  <li>@レプリケーションの遅延量 (MB)</li>
</ul>

<p>
@(注1) テーブルの断片化率は、クラスタ化テーブル(クラスタインデックスが存在するテーブル)を対象に判定が行われます。
</p>

<p>
How to set alert function, Please read <a href="#usage-alert">following passage</a>.
</p>

<h3 id="features-cmdline">@コマンドライン機能</h3>
<p>
@コマンドライン機能はレポート生成および運用管理を行うためのコマンドを提供します。<br>
※コマンドライン機能の使用方法は<a href="#usage-cmdline">こちら</a>をご覧ください。
</p>

<h4>@簡易レポート機能</h4>
<p>
@リポジトリDBに保存されたスナップショットから任意の期間のレポートをテキスト形式で出力するコマンドを提供します。<br>
また、レポートの出力以外に以下の操作を行うことができます。
</p>

<ul>
  <li>@スナップショットの一覧の表示</li>
  <li>@スナップショットの合計サイズの表示</li>
</ul>

<p>
@簡易レポート機能が出力するレポートの項目については「<a href="files/pg_statsinfo_v2.5_report_infomation.xls">pg_statsinfo v2.5 レポート項目一覧</a>」をご覧ください。<br>
なお、簡易レポート機能が出力するレポートの項目は <a href="http://pgstatsinfo.projects.postgresql.org/pg_stats_reporter-ja.html">pg_stats_reporter</a> と同等です。<br>
グラフを用いたグラフィカルなレポートを出力したい場合は <a href="http://pgstatsinfo.projects.postgresql.org/pg_stats_reporter-ja.html">pg_stats_reporter</a> を使用してください。
</p>

<h4>@運用管理機能</h4>
<p>
@pg_statsinfo の運用管理向けの操作を行うコマンドを提供します。<br>
運用管理機能で行うことができる操作は以下のとおりです。
</p>

<ul>
  <li>@スナップショットの取得</li>
  <li>@スナップショットの削除</li>
  <li>@エージェントの停止</li>
  <li>@エージェントの起動</li>
</ul>
<br>

<h3 id="features-maintenance">@自動メンテナンス機能</h3>
<p>@1日1回、任意の時刻に下記のメンテナンス操作を行うことができます。
<ul>
  <li>@保持期間を経過した古いスナップショットの削除</li>
  <li>@サーバログのログファイルの整理</li>
</ul>

<p>@本機能はデフォルトは ON であり、上記の操作を自動メンテナンス実行時刻に実行します。</p>
<p>
@(注1) スナップショットの自動削除が停止している場合、古いスナップショットは自動的に削除されません。必要に応じてユーザ操作で定期的に削除してください。<br>
@(注2) ログファイルの自動整理が停止している場合、古いログファイルは自動的には削除されません。必要に応じてユーザ操作で定期的に削除してください。
</p>

<p>
@自動メンテナンス機能の使用方法は<a href="#usage-maintenance">こちら</a>をご覧ください。
</p>

<h2 id="install">Install</h2>

<h3 id="requirement">Requirement</h3>
<dl>
<dt>PostgreSQL versions</dt>
<dd>PostgreSQL 8.3, 8.4, 9.0, 9.1, 9.2, 9.3 (required --with-libxml configure option. RPM's default setting is with --with-libxml option.)</dd>
<dt>OS</dt>
<dd>RHEL 5.x, 6.x, CentOS 5.x, 6.x</dd>
<dt>Required connections</dt>
<dd>1 connection for the monitored instance / 1 connections for repository.<br/>
2 connections required if monitored instance and repository are in the same server.</dd>
</dl>

<h3 id="procedure">Instlation</h3>

<h4>RPM</h4>
This example is How to install PostgreSQL9.2 x86_64 rpm.
<pre>
$ su
# rpm -ivh pg_statsinfo-2.5.0-1/pg92.rhel6.x86_64.rpm
</pre>

<h4>Source</h4>

<p>You can use pgxs to bulld the module from the source codes.
You don't have to run sql files manually because pg_statsinfo installs them automatically for both monitored instances and repositories.</p>

<pre>
$ cd pg_statsinfo
$ tar xzvf pg_statsinfo-2.5.0.tar.gz 
$ cd pg_statsinfo-2.5.0
$ make USE_PGXS=1
$ su
# make USE_PGXS=1 install
</pre>

<p>Note: RPMs of PostgreSQL 9.0, 9.1, 9.2 change the install directory path. Therefore, the RPM of pg_statsinfo also changes install paths. For example, executable files are installed to "/usr/bin" previously. But from PostgreSQL9.0, these files are installed to "/usr/pgsql-9.0/bin".</p>

<h3 id="install">Configuration</h3>
This section is configuration of pg_statsinfo.

<h4 id="install">Configuration of postgresql.conf</h4>
First, you check the observation postgresql is stoped.
This configuration method is that snapshot repository is same instance in a PostgreSQL database. If you want to config other setting, you read <a href="#configuration">this section</a>.

<pre>
#minimam configuration
shared_preload_libraries = 'pg_statsinfo'       # preload pg_statsinfo libraries
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' # pg_statsinfo need this log_filename setting
</pre>

<pre>
#recommended configuration
shared_preload_libraries = 'pg_statsinfo'       # preload pg_statsinfo libraries
custom_variable_classes = 'pg_statsinfo'

pg_statsinfo.snapshot_interval = 30min          # set snapshot interval 
pg_statsinfo.enable_maintenance = 'on'          # enable maintenance mode('on' or 'off')
pg_statsinfo.maintenance_time = '00:02:00'      # Delete old snapshots every day in this time.
pg_statsinfo.repository_keepday = 7             # keep old snapshots in this period in maintenance.

log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' # pg_statsinfo need this log_filename setting
log_min_messages = 'log'
pg_statsinfo.syslog_min_messages = 'error'
pg_statsinfo.textlog_line_prefix = '%t %p %c-%l %x %q(%u, %d, %r, %a) '  # This format is same as syslog's format.
pg_statsinfo.syslog_line_prefix = '%t %p %c-%l %x %q(%u, %d, %r, %a) '   # This format is same as syslog's format.

track_functions = 'all'
log_checkpoints = on
log_autovacuum_min_duration = 0
#pg_statsinfo.long_lock_threashold = 30s        #threthold parameter for getting LOCK infomation
</pre>

<p>Attention!</p>
<dl>
  <dt>log_destination</dt>
  <dd>Force-set 'csvlog', stderr is eliminated.</dd>
  <dt>logging_collector</dt> 
  <dd>Force-set on.</dd>
</dl>

<h4>Configration of pg_hba.conf</h4>
<p>
Allow the user who run the PostgreSQL server to login the server without any passwords from localhost.
The recommended method is "ident" authentication here.
Add the following line to <a href="http://developer.postgresql.org/pgdocs/postgres/auth-pg-hba-conf.html">pg_hba.conf</a> when you use "OS-user = DB-superuser = postgres", that is the most common case.
Note that you will need to add it in pg_hba.conf in front of other methods.
The ident authentication method with TYPE=local will be convenient on UNIX.
</p>

<pre>
# TYPE  DATABASE        USER            CIDR-ADDRESS            METHOD [for UNIX]
local   all             postgres                                ident
</pre>

<p>Finally, setup postgresql.conf with the following setting when the monitored PostgreSQL instance stops.
In this settings, the repository will be created in 'postgres' database on the same server with monitored database.
See also "<a href="#configuration">Configuration File</a>" for other setting parameters.</p>

<pre>
log_checkpoints = on                      # record checkpoint activities
log_autovacuum_min_duration = 0           # record autovacuum activities
shared_preload_libraries = 'pg_statsinfo' # preload the library
</pre>

<p>
In addition, contrib/pg_statsinfo.sql and contrib/pg_statsrepo.sql are installed automactically. So, you don't need to install them manually. </p>

<h4>Configuration of input query statistic</h4>
<p>
Also, if you use PostgreSQL 8.4 or later, <a href="http://developer.postgresql.org/pgdocs/postgres/pgstatstatements.html">pg_stat_statements</a> is installed in 'postgres' database in the monitored instance, pg_statsinfo gathers the query statistics and add them into snapshot.
If you will use it, run the following command only once at the fist server start.
</p>

<pre>
# @PostgreSQL のバージョンが 9.1 以降の場合
$ psql -d postgres -c "CREATE EXTENSION pg_stat_statements"

# @PostgreSQL のバージョンが 9.0 以前の場合
$ psql -d postgres -f $PGSHARE/contrib/pg_stat_statements.sql
</pre>

<p>@また、必要に応じて設定ファイルに下記のパラメータを設定してください。</p>
<ul>
  <li>pg_statsinfo.stat_statements_max</li>
  <li>pg_statsinfo.stat_statements_exclude_users</li>
</ul>
<p>@上記のパラメータの説明は<a href="#configuration">設定ファイル</a>をご覧ください。</p>

<p>That's all. Install is finished.</p>

<h2 id='usage'>Usage</h2>
<p>This section is explained maintenance and configuration in pg_statsinfo.</p>

<h3 id="start-or-stop">Start or Stop</h3>

<p>You only have to start PostgreSQL server when you start pg_statsinfo.
pg_statsinfo will be kicked to start by the server;
It cannot run in standalone.</p>
<pre>$ pg_ctl start [OPTIONS]</pre>

<p>Also pg_statsinfo automatically stops when PostgreSQL server shutdowns.
Non-smart shutdown with 'pg_ctl stop -m fast|immediate' might cause some error messages, but you can ignore those errors.</p>
<pre>$ pg_ctl stop -m smart [OPTIONS]</pre>

<p>@また、PostgreSQL サーバを終了せずに エージェントのみを停止するには以下のコマンドを実行します。</p>
<pre>$ pg_statsinfo --stop [OPTIONS]</pre>

<p>@停止中のエージェントを起動するには以下のコマンドを実行します。</p>
<pre>$ pg_statsinfo --start [OPTIONS]</pre>

<p><b>@(注1) PostgreSQLの設定パラメータに「shared_preload_libraries = 'pg_statsinfo'」が設定されていない場合は、エージェントの停止／起動が実行できません。</b></p>

<h3 id="snapshot">Get or maintenance snapshot</h3>
<h4>Automatic snapshot</h4>
<p>
Pg_statsinfo gets snapshot every interval time.
Interval time configuration is in the following.
</p>

<p>example: snapshot interval time is 30min</p>
<pre>pg_statsinfo.snapshot_interval = 30min </pre>

<h4>Manual snapshot</h4>
<p>
If you want to get snapshot manualy, you use SQL statsinfo.snapshot function(text DEFAULT NULL).
</p>
<pre>$ psql -d postgres -c "SELECT statsinfo.snapshot('comment')"</pre>

<h4>@自動削除</h4>
<p>@自動メンテナンス機能を使用することで保持期間を経過したスナップショット削除を自動的に削除することができます。<br>
自動メンテナンスのスナップショット削除はデフォルトが ON となっています。</p>
<p>@自動メンテナンス機能の使い方は<a href="#usage-maintenance">こちら</a>をご覧ください。</p>

<h4>@手動削除</h4>
<p>@スナップショットの手動削除は監視対象インスタンスに対して、関数 statsinfo.maintenance(timestamptz) を実行して下さい。
引数で指定した時刻より古いスナップショットが削除されます。</p>

<p>@例: 取得日時が 2011-02-01 07:00:00 より古いスナップショットを削除します。</p>
<pre>$ psql -d postgres -c "SELECT statsinfo.maintenance('2010-02-01 07:00:00'::timestamptz);"</pre>

<h3 id="log">@サーバログのフィルタリング</h3>
<p>
@pg_statsinfo には PostgreSQL のサーバログをフィルタリングにより加工する機能があります。<br>
以下では、出力されるログファイルの種類とフィルタリングの種類を説明します。
</p>

<h4>@ログファイルの種類</h4>
<dl>
  <dt>@CSVログ (*.csv) (例: postgresql-2013-10-01_000000.csv)</dt>
  <dd>@CSVログとは、PostgreSQL が出力する生のログとなります。(CSVログの詳細は<a href="http://www.postgresql.jp/document/current/html/runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-CSVLOG"> こちら </a>をご覧ください)</dd>
  <dd>@pg_statsinfo は本ログの情報を元に加工したログの出力を行いますが、本ログに関しては全く加工を行いません。</dd>
  <dt>@テキストログ (pg_statsinfo.log)</dt>
  <dd>@テキストログとは、PostgreSQL が出力したログ(CSVログ)の情報を元に pg_statsinfo が加工を行ったログです。</dd>
  <dd>@テキストログには以下の特徴があります。
    <ul>
      <li>@テキストログの書式を任意の形式に設定することができます。</li>
      <li>@テキストログのファイルアクセス権限を設定することができます。</li>
      <li>@テキストログのファイル名を設定することができます。</li>
      <li>@特定のユーザのログを除外した内容で出力することができます。</li>
      <li>@特定のSQLSTATEを持つログのメッセージレベルを変更した内容で出力することができます。</li>
    </ul>
  <dd>@テキストログの書式、ファイル名およびファイルアクセス権限は、設定ファイルの下記のパラメータで指定します。(詳細は<a href="#configuration"> こちら </a>をご覧ください)
    <ul>
      <li>pg_statsinfo.textlog_line_prefix</li>
      <li>pg_statsinfo.textlog_permission</li>
      <li>pg_statsinfo.textlog_filename</li>      
    </ul>
  </dd>
  <dt>@ログローテート時の動作</dt>
  <dd>@PostgreSQL のログ(CSVログ)がローテートされた場合、テキストログはCSVログの拡張子を「.log」とした名前にリネームされ、新規にテキストログが作成されます。</dd>
</dl>

<p>
@(注1) ログローテート前に将来リネーム予定のパスに既にファイルが存在する場合がありますが、これは正常な状態です。<br/>
@(注2) 上記のファイル(以降、コンソールログと呼びます)には、アーカイブコマンドなどがコンソールに出力した内容が記録されていますが、コンソールログはログローテート時にテキストログで上書きされます。
</p>

<p>@ログファイルの出力例を以下に示します。</p>
<pre>
$ ls -l $PGDATA/pg_log
-rw------- 1 postgres postgres 433644 Oct  1 23:59 postgresql-2013-10-01_000000.csv
-rw------- 1 postgres postgres 322167 Oct  1 23:59 postgresql-2013-10-01_000000.log
-rw------- 1 postgres postgres 425449 Oct  2 23:59 postgresql-2013-10-02_000000.csv
-rw------- 1 postgres postgres 321695 Oct  2 23:59 postgresql-2013-10-02_000000.log
-rw------- 1 postgres postgres 255424 Oct  3 13:40 postgresql-2013-10-03_000000.csv
-rw------- 1 postgres postgres      0 Oct  3 00:00 postgresql-2013-10-03_000000.log
-rw------- 1 postgres postgres 190786 Oct  3 13:40 pg_statsinfo.log

postgresql-2013-10-01_000000.csv ... @ログローテート済みのCSVログ
postgresql-2013-10-01_000000.log ... @ログローテート済みのテキストログ (上記のCSVログの情報を元に加工したログ)
postgresql-2013-10-02_000000.csv ... @ログローテート済みのCSVログ
postgresql-2013-10-02_000000.log ... @ログローテート済みのテキストログ (上記のCSVログの情報を元に加工したログ)
postgresql-2013-10-03_000000.csv ... @最新のCSVログ
postgresql-2013-10-03_000000.log ... @コンソールログ
pg_statsinfo.log ................... @テキストログ (最新のCSVログの情報を元に加工したログ)
</pre>

<h4>@フィルタリングの種類</h4>
<dl>
  <dt>@メッセージレベルによる出力制御</dt>
  <dd>@特定のメッセージレベルより低いレベルのログをテキストログに出力しないようにフィルタリングします。</dd>
  <dd>@特定のメッセージレベルは、設定ファイル(postgresql.conf)の下記のパラメータで指定します。</dd>
  <dd>@設定の詳細については、<a href="#configuration">設定ファイル</a>をご覧ください。</dd>
  <dd>
    <ul>
      <li>pg_statsinfo.textlog_min_messages</li>
    </ul>
  </dd>
  <dd>@設定例: warning 以上のメッセージレベルのログをテキストログに出力する</dd>
  <dd>
    <pre>pg_statsinfo.textlog_min_messages = warning</pre>
  </dd>
  <dt>@特定ユーザのセッションのログの出力制御</dt>
  <dd>@特定ユーザのセッションのログをテキストログに出力しないようにフィルタリングします。</dd>
  <dd>@特定ユーザは、設定ファイル(postgresql.conf)の下記のパラメータで指定します。</dd>
  <dd>@設定の詳細については、<a href="#configuration">設定ファイル</a>をご覧ください。</dd>
  <dd>
    <ul>
      <li>pg_statsinfo.textlog_nologging_users</li>
    </ul>
  </dd>
  <dd>@設定例: postgres ユーザのセッションのログをテキストログに出力しない</dd>
  <dd>
    <pre>pg_statsinfo.textlog_nologging_users = 'postgres'</pre>
  </dd>
  <dt>@メッセージレベルの変更</dt>
  <dd>@特定のSQLSTATEを持つログのメッセージレベルを任意のメッセージレベルに変更します。</dd>
  <dd>@メッセージレベルの変更対象のSQLSTATEおよび変更後のメッセージレベルは、設定ファイル(postgresql.conf)の下記のパラメータで指定します。</dd>
  <dd>@設定の詳細については、<a href="#configuration">設定ファイル</a>をご覧ください。</dd>
  <dd>
    <ul>
      <li>pg_statsinfo.adjust_log_level</li>
      <li>pg_statsinfo.adjust_log_info</li>
      <li>pg_statsinfo.adjust_log_notice</li>
      <li>pg_statsinfo.adjust_log_warning</li>
      <li>pg_statsinfo.adjust_log_error</li>
      <li>pg_statsinfo.adjust_log_log</li>
      <li>pg_statsinfo.adjust_log_fatal</li>
    </ul>
  </dd>
  <dd>@設定例: SQLSTATEが '42P01' のログのメッセージレベルを 'INFO' に変更する</dd>
  <dd>
    <pre>pg_statsinfo.adjust_log_level = on
pg_statsinfo.adjust_log_info = '42P01'</pre>
  </dd>
</dl>

<h4>@自動メンテナンス機能によるログファイル整理</h4>
<p>@自動メンテナンス機能を使用することでログファイルの整理を行うことができます。<br>
自動メンテナンスのログファイル整理はデフォルトが ON となっています。</p>
<p>@自動メンテナンス機能の使い方は<a href="#usage-maintenance">こちら</a>をご覧ください。</p>

<h3 id="usage-alert">Usage of Alert Function</h3>
<p>
In default setting, Alert function is always ON in each instance.
<br>
</p>

<h4>Change Alert Settings</h4>
<p>
You can change the threshold of alert function and ON or OFF function.<br/>
@また、アラート条件(閾値)を「-1」に設定することで一部のアラート項目のみ無効とすることができます。
</p>

<p>
If you want to change the threshold of alert function, you should update the alert function table.<br/>
@なお、アラート設定の変更を行うには、アラート設定を変更する監視対象インスタンスの初回スナップショットが完了している必要があることに注意してください。
</p>

Examples: Set ROLLBACK / sec thereshold to 3000
<pre>
# UPDATE statsrepo.alert SET commit_tps = 3000 WHERE instid = &lt;instance ID\&gt;
</pre>

@設定例: 秒間ロールバック数のアラートを無効にする場合
<pre>
# UPDATE statsrepo.alert SET rollback_tps = -1 WHERE instid = &lt;instance ID\&gt;
</pre>

Exmaples: Disable Alert Function
<pre>
# UPDATE statsrepo.alert SET enable_alert = false WHERE instid = &lt;instance ID&gt;
</pre>

<h4>Infomation of Alert Setting Table</h4>
<p>
Alert setting table is stored alert function parameter and disable of enable
 information.
<br>
Alert setting table is "statsrepo.alert". And, setting table's schema is in following:
<br>
</p>

<table>
<thead>
  <tr>
    <th>column</th>
    <th>data type</th>
    <th>default parameter</th>
    <th>explanation</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>instid</td>
    <td>bigint</td>
    <td> - </td>
    <td>instance ID</td>
  </tr>
  <tr>
    <td>rollback_tps</td>
    <td>bigint</td>
    <td>100</td>
    <td>ROLLBACK / sec</td>
  </tr>
  <tr>
    <td>commit_tps</td>
    <td>bigint</td>
    <td>1000</td>
    <td>COMMIT / sec</td>
  </tr>
  <tr>
    <td>garbage_size</td>
    <td>bigint</td>
    <td>20000</td>
    <td>garbage size (MB)</td>
  </tr>
  <tr>
    <td>garbage_percent</td>
    <td>integer</td>
    <td>30</td>
    <td>percentage of garbage size ratio(%)</td>
  </tr>
  <tr>
    <td>response_avg</td>
    <td>bigint</td>
    <td>10</td>
    <td>average time of query responce (sec)</td>
  </tr>
  <tr>
    <td>response_worst</td>
    <td>bigint</td>
    <td>60</td>
    <td>longest time of query responce (sec)</td>
  </tr>
  <tr>
    <td>fragment_percent</td>
    <td>integer</td>
    <td>70</td>
    <td>@各テーブルの断片化率(correlation)(%)</td>
  </tr>
  <tr>
    <td>backend_max</td>
    <td>integer</td>
    <td>100</td>
    <td>@バックエンドの最大数</td>
  </tr>
  <tr>
    <td>disk_remain_percent</td>
    <td>integer</td>
    <td>20</td>
    <td>@テーブルスペースのディスク空き容量の割合(%)</td>
  </tr>
  <tr>
    <td>loadavg_1min</td>
    <td>real</td>
    <td>7.0</td>
    <td>@過去1分間のロードアベレージ</td>
  </tr>
  <tr>
    <td>loadavg_5min</td>
    <td>real</td>
    <td>6.0</td>
    <td>@過去5分間のロードアベレージ</td>
  </tr>
  <tr>
    <td>loadavg_15min</td>
    <td>real</td>
    <td>5.0</td>
    <td>@過去15分間のロードアベレージ</td>
  </tr>
  <tr>
    <td>swap_size</td>
    <td>integer</td>
    <td>1000000</td>
    <td>@スワップ使用量(KB)</td>
  </tr>
  <tr>
    <td>rep_flush_delay</td>
    <td>integer</td>
    <td>100</td>
    <td>@マスタとスタンバイ間のWAL書き込み遅延量(MB)</td>
  </tr>
  <tr>
    <td>rep_replay_delay</td>
    <td>integer</td>
    <td>200</td>
    <td>@スタンバイのリカバリ遅延量(MB)</td>
  </tr>
  <tr>
    <td>enable_alert</td>
    <td>boolean</td>
    <td>true</td>
    <td>enable or disabele for alert function (TRUE is enable and FALSE is disable)
</td>
  </tr>
</tbody>
</table>

<p>
Please don't delete an alert table's tuple.<br>
If you delete the tuple, you can not set the alert function in the instance.
</p>

<h3 id="usage-cmdline">@コマンドライン機能の使い方</h3>

<h4>@ポート生成</h4>
<pre>
$ pg_statsinfo -r REPORTID [-i INSTANCEID] [-b SNAPID] [-e SNAPID] [-B DATE] [-E DATE] [-o FILENAME] [connection-options]
</pre>

<p>
@以下にコマンド例を示します。<br>
以下のコマンド例では、ホスト名 localhost 上のポート 5432 で稼動しているリポジトリDBに対して、postgres データベースに、postgres ユーザで接続し、以下の条件のレポートを出力します。
</p>
<ul>
  <li>@レポート種別IDが All のレポート</li>
  <li>@レポート範囲は最初のスナップショットから最後のスナップショット</li>
  <li>@レポート対象は全ての監視対象インスタンス</li>
  <li>@レポートの出力先は標準出力</li>
</ul>

<pre>
$ pg_statsinfo  -r All -h localhost -d postgres -p 5432 -U postgres
</pre>

<dl>
  <dt>-r, --report=REPORTID</dt>
  <dd>@レポート種別IDを指定します。</dd>
  <dd>@レポート種別IDに指定できる値は以下のとおりです。</dd>
  <dd>@レポート種別IDとレポートの内容についての対応は「<a href="files/pg_statsinfo_v2.5_report_infomation.xls">pg_statsinfo v2.5 レポート項目一覧</a>」をご覧ください。</dd>
  <dd>
    <ul>
      <li>Summary</li>
      <li>DatabaseStatistics</li>
      <li>InstanceActivity</li>
      <li>OSResourceUsage</li>
      <li>DiskUsage</li>
      <li>LongTransactions</li>
      <li>NotableTables</li>
      <li>CheckpointActivity</li>
      <li>AutovacuumActivity</li>
      <li>QueryActivity</li>
      <li>LockConflicts</li>
      <li>ReplicationActivity</li>
      <li>SettingParameters</li>
      <li>SchemaInformation</li>
      <li>Profiles</li>
      <li>All</li>
    </ul>
  </dd>
  <dd>@レポート種別IDは、頭文字からの最短一致での指定を許容し、大文字と小文字を区別しません。</dd>
  
  <dt>-i, --instid=INSTANCEID</dt>
  <dd>@レポート対象とする監視対象インスタンスの識別子を指定します。</dd>
  <dd>@本オプションは省略可能です。省略時は全ての監視対象インスタンスがレポート対象です。</dd>
  
  <dt>-b, --beginid=SNAPID</dt>
  <dd>@レポート範囲の開始点とするスナップショットをスナップショットIDで指定します。</dd>
  <dd>@本オプションは省略可能です。省略時は最初のスナップショットを開始点とします。</dd>
  <dd>@本オプションと「--B, --begindate」または「-E, --enddate」を同時に指定することはできません。</dd>
  
  <dt>-e, --endid=SNAPID</dt>
  <dd>@レポート範囲の終了点とするスナップショットをスナップショットIDで指定します。</dd>
  <dd>@本オプションは省略可能です。省略時は最後のスナップショットを終了点とします。</dd>
  <dd>@本オプションと「--B, --begindate」または「-E, --enddate」を同時に指定することはできません。</dd>
  
  <dt>-B, --begindate=DATE</dt>
  <dd>@レポート範囲の開始点とするスナップショットを日時 (YYYY-MM-DD HH:MI:SS形式) で指定します。</dd>
  <dd>@本オプションは省略可能です。省略時は最初のスナップショットを開始点とします。</dd>
  <dd>@本オプションと「--b, --beginid」または「-e, --endid」を同時に指定することはできません。</dd>
  
  <dt>-E, --enddate=DATE</dt>
  <dd>@レポート範囲の終了点とするスナップショットを日時 (YYYY-MM-DD HH:MI:SS形式) で指定します。</dd>
  <dd>@本オプションは省略可能です。省略時は最後のスナップショットを終了点とします。</dd>
  <dd>@本オプションと「--b, --beginid」または「-e, --endid」を同時に指定することはできません。</dd>
  
  <dt>-o, --output=FILENAME</dt>
  <dd>@レポートの出力先ファイル名を指定します。</dd>
  <dd>@本オプションは省略可能です。省略時はレポートを標準出力に出力します。</dd>
  <dd>@指定したファイルが既に存在する場合は上書きします。</dd>
</dl>

<br>

<h4>@スナップショット一覧表示</h4>
<pre>
$ pg_statsinfo -l [-i INSTANCEID] [connection-options]
</pre>

<p>
@以下にコマンド例を示します。<br>
以下のコマンド例では、ホスト名 localhost 上のポート 5432 で稼動しているリポジトリDBに対して、postgres データベースに、postgres ユーザで接続し、当該リポジトリDBに蓄積されているスナップショットの一覧を表示します。
</p>

<pre>
$ pg_statsinfo -l -h localhost -d postgres -p 5432 -U postgres
</pre>

<dl>
  <dt>-l, --list</dt>
  <dd>@本オプションが指定された場合はスナップショット一覧の表示を行います。</dd>
  
  <dt>-i, --instid=INSTANCEID</dt>
  <dd>@スナップショット一覧を表示する監視対象インスタンスの識別子を指定します。</dd>
  <dd>@本オプションは省略可能です。省略時は全ての監視対象インスタンスのスナップショット一覧を表示します。</dd>
</dl>

<br>

<h4>@スナップショットサイズ表示</h4>
<pre>
$ pg_statsinfo -s [connection-options]
</pre>

<p>
@以下にコマンド例を示します。<br>
以下のコマンド例では、ホスト名 localhost 上のポート 5432 で稼動しているリポジトリDBに対して、postgres データベースに、postgres ユーザで接続し、当該リポジトリDBに蓄積されているスナップショットのサイズを表示します。
</p>

<pre>
$ pg_statsinfo -s -h localhost -d postgres -p 5432 -U postgres
</pre>

<dl>
  <dt>-s, --size</dt>
  <dd>@本オプションが指定された場合はスナップショットサイズの表示を行います。</dd>
</dl>

<br>

<h4>@スナップショット取得</h4>
<pre>
$ pg_statsinfo -S COMMENT [connection-options]
</pre>

<p>
@以下にコマンド例を示します。<br>
以下のコマンド例では、ホスト名 localhost 上のポート 5432 で稼動している監視対象インスタンスに対して、postgres データベースに、postgres ユーザで接続し、'COMMENT'をコメントとして付与したスナップショットを取得します。
</p>

<pre>
$ pg_statsinfo -S 'COMMENT' -h localhost -d postgres -p 5432 -U postgres
</pre>

<dl>
  <dt>-S, --snapshot=COMMENT</dt>
  <dd>@本オプションが指定された場合はスナップショットの取得を行います。</dd>
  <dd>@オプション引数にはスナップショットに付与するコメントを指定します。</dd>
</dl>

<br>

<h4>@スナップショット削除</h4>
<pre>
$ pg_statsinfo -D SNAPID [connection-options]
</pre>

<p>
@以下にコマンド例を示します。<br>
以下のコマンド例では、ホスト名 localhost 上のポート 5432 で稼動しているリポジトリDBに対して、postgres データベースに、postgres ユーザで接続し、当該リポジトリDBに蓄積されているスナップショットIDが 123 のスナップショットを削除します。
</p>

<pre>
$ pg_statsinfo -D 123 -h localhost -d postgres -p 5432 -U postgres
</pre>

<dl>
  <dt>-D, --delete=SNAPID</dt>
  <dd>@本オプションが指定された場合はスナップショットの削除を行います。</dd>
  <dd>@オプション引数には削除対象のスナップショットのスナップショットIDを指定します。</dd>
</dl>

<br>

<h4>@エージェント停止</h4>
<pre>
$ pg_statsinfo --stop [connection-options]
</pre>

<p>
@以下にコマンド例を示します。<br>
以下のコマンド例では、ホスト名 localhost 上のポート 5432 で稼動している監視対象インスタンスに対して、postgres データベースに、postgres ユーザで接続し、エージェントを停止します。
</p>

<pre>
$ pg_statsinfo --stop -h localhost -d postgres -p 5432 -U postgres
</pre>

<dl>
  <dt>--stop</dt>
  <dd>@本オプションが指定された場合は エージェントを停止します。</dd>
</dl>

<br>

<h4>@エージェント起動</h4>
<pre>
$ pg_statsinfo --start [connection-options]
</pre>

<p>
@以下にコマンド例を示します。<br>
以下のコマンド例では、ホスト名 localhost 上のポート 5432 で稼動している監視対象インスタンスに対して、postgres データベースに、postgres ユーザで接続し、エージェントを起動します。
</p>

<pre>
$ pg_statsinfo --start -h localhost -d postgres -p 5432 -U postgres
</pre>

<dl>
  <dt>--start</dt>
  <dd>@本オプションが指定された場合は エージェントを起動します。</dd>
</dl>

<br>

<h4>@共通オプション (connection-options)</h4>
<p>
@データベース接続に関するオプションです。<br>
スナップショット取得を実行する場合は監視対象インスタンス、それ以外はリポジトリDBへの接続情報を指定します。
</p>

<dl>
  <dt>-d, --dbname=DBNAME</dt>
  <dd>@接続するデータベース名を指定します。</dd>
  <dd>@本オプションが指定されていない場合は環境変数「PGDATABASE」の値が使用されます。<dd>
  <dd>@環境変数も設定されていない場合は、接続時に指定したユーザ名が使用されます。</dd>
  
  <dt>-h, --host=HOSTNAME</dt>
  <dd>@サーバが稼働しているマシンのホスト名を指定します。</dd>
  <dd>@ホスト名がスラッシュから始まる場合、Unixドメインソケット用のディレクトリとして使用されます。</dd>
  
  <dt>-p, --port=PORT</dt>
  <dd>@サーバが接続を監視するTCPポートもしくはUnixドメインソケットファイルの拡張子を指定します。</dd>
  
  <dt>-U, --username=USERNAME</dt>
  <dd>@接続するユーザ名を指定します。</dd>
  
  <dt>-w, --no-password</dt>
  <dd>@パスワードの入力を促しません。サーバがパスワード認証を必要とし、かつ、.pgpassファイルなどの他の方法が利用できない場合、接続試行は失敗します。</dd>
  
  <dt>-W, --password</dt>
  <dd>@データベースに接続する前に、強制的にパスワード入力を促します。</dd>
</dl>

<br>

<h4 id="usage-maintenance">Automatic maintenance</h4>
<p>
If you want to maintain snapshot repository, you configure automatic maintenance mode in postgresql.conf.
Auto maintenance is executed every day.
Enable auto maintenance mode is in the following.
</p>
<pre>
pg_statsinfo.enable_maintenance = 'on'
pg_statsinfo.maintenance_time = '00:00:00'
pg_statsinfo.repository_keepday = 7
</pre>

<p>@(注1) 自動メンテナンスのスナップショット削除はデフォルトで有効となっています。</p>
<p>@(注2) 自動メンテナンスのログファイル整理と併せて使用する場合は自動メンテナンス設定を 'on' に設定するかカンマ区切りで 'log' を追記してください。</p>
<p>Caution! : If you don't use automatic maintenance mode, repository size will be very large. Plese maintenance repository manualy in every term.</p>
<p>@(注4) 複数監視対象インスタンス－単一リポジトリDBの構成で、各監視対象インスタンスのスナップショットの保持期間を
互いに異なる期間に設定した場合、自動メンテナンス実行時には最も短く設定した期間のスナップショットが保持されます。
例えば、各監視対象インスタンスの postgresql.conf に以下のようにスナップショット保持期間(pg_statsinfo.repository_keepday)の
設定を記述した場合、自動メンテナンス実行時のスナップショット保持期間として反映されるのは監視対象インスタンス3の設定となります。</p>

<pre>
<@監視対象インスタンス1>
pg_statsinfo.enable_maintenance = 'snapshot' 
pg_statsinfo.repository_keepday = 7
<@監視対象インスタンス2>
pg_statsinfo.enable_maintenance = 'snapshot' 
pg_statsinfo.repository_keepday = 5
<@監視対象インスタンス3>
pg_statsinfo.enable_maintenance = 'snapshot' 
pg_statsinfo.repository_keepday = 3
</pre>

<h4>@ログファイル整理</h4>
<p>@自動メンテナンスのログファイル整理を有効にすると、1日1回任意の時刻にサーバログの整理を行うための任意のシェルコマンドを実行することができます。<br>
自動メンテナンスのログファイル整理を有効にするには、設定ファイル(postgresql.conf)に以下の設定を記述します。</p>

<p>@例: 毎日0時2分に前日以前のCSVログファイルを圧縮アーカイブする</p>
<pre>
pg_statsinfo.enable_maintenance = 'log'     # @自動メンテナンス設定
pg_statsinfo.maintenance_time = '00:02:00'  # @自動メンテナンス実行時刻設定
pg_statsinfo.log_maintenance_command = '&ltPGHOME&gt/bin/archive_pglog.sh %l'  # @ログファイル整理コマンド設定 (*1)
@※&ltPGHOME&gt: PostgreSQL インストールディレクトリ

(*1) archive_pglog.sh
@archive_pglog.sh は同梱されるシェルスクリプトです。
@前日以前のCSVログファイルを圧縮アーカイブし、ログファイル格納ディレクトリ配下にアーカイブファイル(TGZ)を作成します。
@また、アーカイブしたCSVログファイルをログファイル格納ディレクトリから削除します。
</pre>

<p>@(注1) 自動メンテナンスのログファイル整理はデフォルトで有効となっています。</p>
<p>@(注2) 自動メンテナンスのスナップショット削除と併せて使用する場合は自動メンテナンス設定を 'on' に設定するかカンマ区切りで 'snapshot' を追記してください。</p>
<p>@(注3) ログファイル整理コマンドの設定を省略した場合、上記の例と同じコマンドが適用されます。</p>

<br>

<h3 id="configuration">Configuration File</h3>
<p>Configuration parameters and usages are explained in the section.</p>
<p>pg_statsinfo uses postgresql.conf in the monitored instance for a configuration file.
Settings in the configuration file are read at the instance's startup and reloads with 'pg_ctl reload'.</p>

<p>
You must setup the following parameters before using pg_statsinfo.
Some of the paramters cannot be changed online and require server's restart.
</p>

<table>
<caption>must-set parameters</caption>
<thead>
  <tr>
    <th>Name</th>
    <th>Setting</th>
    <th>Description</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>shared_preload_libraries</td>
    <td>'pg_statsinfo'</td>
    <td>Preloaded libraries.
        If you also use pg_stat_statements, append the module name with a comma like 'pg_statsinfo, pg_stat_statements'.</td>
  </tr>
  <tr>
    <td>log_filename</td>
    <td>'postgresql-%Y-%m-%d_%H%M%S.log'</td>
    <td>@CSVログおよびテキストログのファイル名。デフォルトから変更する場合でも、%Y, %m, %d, %H, %M, %S がこの順に全て表れる形式でなければなりません。</td>
  </tr>
  <tr>
    <td>track_counts</td>
    <td>on</td>
    <td>Enables collection of statistics on database activity.</td>
  </tr>
  <tr>
    <td>track_activities</td>
    <td>on</td>
    <td>Enables the collection of information on the currently executing command of each session.</td>
  </tr>
  <tr>
    <td>log_min_messages</td>
    <td>debug5 &sim; log</td>
    <td>A message level threshoulds for server logs.
        The value must be more verbose than 'log', pg_statsinfo.syslog_min_messages, and pg_statsinfo.textlog_min_messages.</td>
  </tr>
  <tr>
    <td>log_timezone</td>
    <td>unknown, gmt, utc</td>
    <td>Only those values are supported.</td>
  </tr>
  <tr>
    <td>log_destination</td>
    <td>must have 'csvlog', and can have 'syslog' or 'eventlog' optionally</td>
    <td>pg_statsinfo always adds 'csvlog' and removes 'stderr' during startup.</td>
  </tr>
  <tr>
    <td>logging_collector</td>
    <td>on</td>
    <td>pg_statsinfo always set it to this value during startup.</td>
  </tr>
</tbody>
</table>

<p>There some optional parameters that affect pg_statsinfo's activities.
They can be changed online when reloaded with pg_ctl reload.

<p>If you use PostgreSQL 8.3, read 'pg_statsinfo.*' as 'statsinfo.*'.</p>

<table>
<caption>optional parameters</caption>
<thead>
  <tr>
    <th>Name</th>
    <th>Default Setting</th>
    <th>Description</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>track_functions</td>
    <td>none</td>
    <td>Enables tracking of function call counts and time used.
        Set to 'pl' or 'all' if you want pg_statsinfo to gather the statistics.</td>
  </tr>
  <tr>
    <td>track_io_timing</td>
    <td>off</td>
    <td>@ブロックの読み込みと書き込み時間に関する統計情報の収集設定。ブロックの読み書きに関する統計情報を収集する場合は on を設定します。<br>
        本パラメータを on に設定した場合、現時点の時刻をオペレーティングシステムに繰り返し問い合わせるので、プラットフォームによっては深刻な負荷の原因になる可能性がある点を留意してください。<br>
        (本パラメータはPostgreSQL 9.2以降から指定可能です)</td>
  </tr>
  <tr>
    <td>log_checkpoints</td>
    <td>off</td>
    <td>Causes checkpoints to be logged in the server log.
       'on' is recommended.</td>
  </tr>
  <tr>
    <td>log_autovacuum_min_duration</td>
    <td>-1</td>
    <td>Causes autovacuums to be logged in the server log.
        0 &sim; 1min are recommended.</td>
  </tr>
  <tr>
    <td>log_directory</td>
    <td>'pg_log'</td>
    <td>A directory for csvlog and textlog files.</td>
  </tr>
  <tr>
    <td>log_filename</td>
    <td>'postgresql-%Y-%m-%d_%H%M%S.log'</td>
    <td>A file format for csvlog and textlog files.
        The value should be contain %Y, %m, %d, %H, %M, and %S in this order.</td>
  </tr>
  <tr>
    <td>log_rotation_age</td>
    <td>1d</td>
    <td>Rotates logs in the specified duration.</td>
  <tr>
  </tr>
    <td>log_rotation_size</td>
    <td>10MB</td>
    <td>Rotates logs in the specified file size.
        The size will be compared with csvlogs.</td>
  <tr>
  </tr>
  <tr>
    <td>syslog_facility</td>
    <td>'LOCAL0'</td>
    <td>syslog facility</td>
  </tr>
  <tr>
    <td>syslog_ident</td>
    <td>'postgres'</td>
    <td>syslog indent</td>
  </tr>
  <tr>
    <td>custom_variable_classes</td>
    <td>-</td>
    <td>Required when you set parameters that starts with "pg_statsinfo.".</td>
  </tr>
  <tr>
    <td>pg_statsinfo.textlog_min_messages</td>
    <td>warning</td>
    <td>Minimum message levels for textlog (*1).</td>
  </tr>
  <tr>
    <td>pg_statsinfo.syslog_min_messages</td>
    <td>disable</td>
    <td>Minimum message levels for syslog (*1).
        Event log is used on Windows instead of syslog.
    </td>
  </tr>
  <tr>
    <td>pg_statsinfo.textlog_filename</td>
    <td>'pg_statsinfo.log'</td>
    <td>Textlog filename. Should not be empty.</td>
  </tr>
  <tr>
    <td>pg_statsinfo.textlog_line_prefix</td>
    <td>'%t %p '</td>
    <td>A printf-style string that is output at the beginning of each textlog line. (*2)</td>
  </tr>
  <tr>
    <td>pg_statsinfo.syslog_line_prefix</td>
    <td>'%t %p '</td>
    <td>A printf-style string that is output at the beginning of each syslog line. (*2)
        Note that timestamp and process IDs appended by syslog is replaced to values of pg_statsinfo daemon.
        So, you need to add %t and %p to record the original values.
    </td>
  </tr>
  <tr>
    <td>pg_statsinfo.textlog_permission</td>
    <td>0600</td>
    <td>Permission setting for textlog files.</td>
  </tr>
  <tr>
    <td>pg_statsinfo.textlog_nologging_users</td>
    <td>-</td>
    <td>@テキストログのフィルタリング設定。テキストログへの出力を除外するユーザを設定します。複数のユーザを設定する場合はカンマ区切りで指定します。</td>
  </tr>
  <tr>
    <td>pg_statsinfo.sampling_interval</td>
    <td>5s</td>
    <td>sampling interval (*3)</td>
  </tr>
  <tr>
    <td>pg_statsinfo.snapshot_interval</td>
    <td>10min</td>
    <td>snapshot interval (*3)</td>
  </tr>
  <tr>
    <td>pg_statsinfo.excluded_dbnames</td>
    <td>'template0, template1'</td>
    <td>Unmonitored database names.</td>
  </tr>
  <tr>
    <td>pg_statsinfo.excluded_schemas</td>
    <td>'pg_catalog, pg_toast, information_schema'</td>
    <td>@監視対象から除外するスキーマ名</td>
  </tr>
  <tr>
    <td>pg_statsinfo.repository_server</td>
    <td>'dbname=postgres'</td>
    <td>Connection string to connect the repository (*4). You need to avoid password input.</td>
  </tr>
  <tr>
    <td>pg_statsinfo.adjust_log_level</td>
    <td>off</td>
    <tdConfiguration of changing server log message level</td>
  </tr>
  <tr>
    <td>pg_statsinfo.adjust_log_info</td>
    <td>-</td>
    <td>Configuration of SQLSTATE which is changing massage level for INFO(*5)</td>
  </tr>
  <tr>
    <td>pg_statsinfo.adjust_log_notice</td>
    <td>-</td>
    <td>Configuration of SQLSTATE which is changing massage level for NOTICE(*5)</td>
  </tr>
  <tr>
    <td>pg_statsinfo.adjust_log_warning</td>
    <td>-</td>
    <td>Configuration of SQLSTATE which is changing massage level for WARNING(*5)</td>
  </tr>
  <tr>
    <td>pg_statsinfo.adjust_log_error</td>
    <td>-</td>
    <td>Configuration of SQLSTATE which is changing massage level for ERROR(*5)</td>
  </tr>
  <tr>
    <td>pg_statsinfo.adjust_log_log</td>
    <td>-</td>
    <td>Configuration of SQLSTATE which is changing massage level for LOG(*5)</td>
  </tr>
  <tr>
    <td>pg_statsinfo.adjust_log_fatal</td>
    <td>-</td>
    <td>Configuration of SQLSTATE which is changing massage level for FATAL(*5)</td>
  </tr>
  <tr>
    <td>pg_statsinfo.enable_maintenance</td>
    <td>'on'</td>
    <td>Setting of auto_maintenance.
      <ul>
        <li>'snapshot': Delete snapshot</li>
        <li>'log': Clean log file</li>
        <li>'snapshot, log': Delete snapshot and clean log file</li>
        <li>'on': Delete snapshot and clean log file</li>
        <li>'off': none</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td>pg_statsinfo.maintenance_time</td>
    <td>'00:02:00'</td>
    <td>@自動メンテナンス実行時刻設定</td>
  </tr>
  <tr>
    <td>pg_statsinfo.repository_keepday</td>
    <td>7</td>
    <td>@スナップショットの保持期間設定</td>
  </tr>
  <tr>
    <td>pg_statsinfo.log_maintenance_command</td>
    <td>&ltPGHOME&gt/bin/archive_pglog.sh %l</td>
    <td>This parameter is server log cleanup command. If we use default shell, old server log is decommpressed.</td>
  </tr>
  <tr>
    <td>pg_statsinfo.long_lock_threashold</td>
     <td>30s</td>
     <td>Threashold of getting LOCK infomation in pg_locks.</td>
  </tr>
  <tr>
    <td>pg_statsinfo.stat_statements_max</td>
    <td>30</td>
    <td>Upper limit of information in pg_stat_statements.</td>
  </tr>
  <tr>
    <td>pg_statsinfo.stat_statements_exclude_users</td>
    <td>-</td>
    <td>Exclude user in pg_stat_statements. If you want to set multi user, you use separator ','.</td>
  </tr>
  <tr>
    <td>pg_statsinfo.controlfile_fsync_interval</td>
    <td>1min</td>
    <td>@pg_statsinfoの制御ファイルの更新をストレージデバイスに同期書き出し(fsync)する間隔を設定します。</td>
  </tr>
</tbody>
</table>

<dl>
<dt>*1 : Message Levels</dt>
<dd>
The following values are available for message levels.
The specified level and more verbose messages are recorded in the logs.
"disable" will record no logs.
The order fo levels are same as <a href="http://www.postgresql.jp/document/8.3/html/runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-WHEN">log_min_messages</a> except additional "disable" and "alert" levels and "debug".
</dd>
<dd>disable &gt; alert &gt; panic &gt; fatal &gt; log &gt; error &gt; warning &gt; notice &gt; info &gt; debug</p></dd>

<dt>*2 : Prefix Format</dt>
<dd>Spefied with the same format with configuration parameter <a href="http://developer.postgresql.org/pgdocs/postgres/runtime-config-logging.html#GUC-LOG-LINE-PREFIX">log_line_prefix</a>.
Note that log_line_prefix itself is ignored when pg_statsinfo is enabled.
</dd>

<dt>*3 : Time Format</dt>
<dd>
Available units are d (day), h (hour), min (minite), and s (second).
If no unit, the value is interpreted as seconds.</dd>
<dd>Using pg_statsinfo in Postgresql 8.3, please set second unit(not nesessary 's').(ex. 3min = 180)<dd>

<dt>*4 : Connection String</dt>
<dd>
It is a libpq-style connection string.
For example, 'hostaddr=127.0.0.1 port=5432 dbname=mydb user=postgres'.
<b>Here, set username is superuser. </b>
See also PQconnectdb in "<a href="http://developer.postgresql.org/pgdocs/postgres/libpq-connect.html">Database Connection Control Functions</a>" for details.
In addition, <a href="http://developer.postgresql.org/pgdocs/postgres/libpq-envars.html">environment variables</a> used by libpq will be used.
</dd>
<dd>
You need to avoid password input to connect the repository.
If password is required, create <a href="http://developer.postgresql.org/pgdocs/postgres/libpq-pgpass.html">.pgpass</a> for the OS user who execute the local postgres server to connect the repository to automate password input.
And, If you use .pgpass file, please set host name in connection string to repository in "host=xxxx".
</dd>
<dt>*5 : SQLSTATE</dt>
<dd>
SQLSTATE is log state like '42P01' and '42P02'.
If you change this SQLSTATE for INFO log level, you set pg_statsinfo.adjust_log_info = '42P01,42P02'.
</dd>
</dl>

<h4>Reload Configuration Files</h4>
<p>If you want to reset configuration parameters online, just modify postgresql.conf and send a reload signal with pg_ctl.
</p>
<pre>$ pg_ctl reload</pre>

<h3 id="user-operations">@運用上必要となる作業</h3>
<p>@ユーザが行う必要のある操作と運用上必要となる作業について説明します。</p>

<h4>@サーバログの削除</h4>
<p>@不要となった古いログファイル(CSVログ、テキストログ)は定期的に削除して下さい。<br>
不要となったログファイルの削除は手動で行うか、自動メンテナンスのログファイル整理を利用して下さい。</p>

<h4>Rotate Logs</h4>
<p>if you want to rotate logs in arbitrary time, execute the following function on the monitored instance.</p>
<pre>$ psql -d postgres -c "SELECT pg_rotate_logfile()"</pre>

<h4 id="on-abort">@異常終了時の対処</h4>
<p>@エージェントのみが異常終了しても、PostgreSQL インスタンスには影響はありませんが、エージェントの機能は停止したままになってしまいます。<br>
エージェントを再起動するには PostgreSQL インスタンスを再起動してください。<br>
なお、エージェントが異常終了してから再起動するまでの間に出力されたサーバログは、再起動時に解析(サーバログの分配のみ)されます。
</p>

<h3 id="uninstall">Uninstall</h3>
<p>When you uninstall pg_statsinfo, you have to restart PostgreSQL server after removing 'pg_statsinfo' from <code>shared_preload_libraries</code> and all of <code>pg_statsinfo.*</code> parameters in postgresql.conf.
</p>

<p>After that, drop all objects used by pg_statsinfo installed in the monitored instance. Run $PGSHARE/contrib/uninstall_pg_statsinfo.sql for 'postgres' database in the monitored instance.</li>
<pre>$ psql -d postgres -f $PGSHARE/contrib/uninstall_pg_statsinfo.sql </pre>

<p>If you also want to delete snapshots, run $PGSHARE/contrib/uninstall_pg_statsrepo.sql to the repository.
Be careful to run the script file because it will delete all of snapshots including other server's ones when the repository was shared by multiple monitored instances.</p>

<pre>$ psql -d &lt;repository&gt; -f $PGSHARE/contrib/uninstall_pg_statsrepo.sql </pre>

<h2 id="restrictions">Restrictions</h2>
<p>There are still some restrictions and limitations in pg_statsinfo.</p>

<dl>
<dt>Requires the same encoding and lc_messages setting on all databases in the monitored instance</dt>
<dd>
pg_statsinfo supports encodings and message locales in PostgreSQL, but all of database in an instance must use the same encoding and locale because mixed-encoded server logs cannot be parsed correctly.
</dd>

<dt>Restrictions for log_filename</dt>
<dd>pg_statsinfo expects log_filename behaves as the following:
<ul>
  <li>Every restarts of the server always create new log files.
      (The logs must have 'seconds' unit in their filename.)</li>
  <li>Server log are named ascending order.</li>
</ul>
You also delete all of the server log files before you modify log_filename setting to avoid any new logs have smaller names than older logs.
</dd>

<dt>Restrictions for pg_statsinfo.textlog_filename</dt>
<dd>A fixed named textlog is always required.</dd>

<dt>log_timezone should be unknown, gmt, or utc</dt>
<dd>
Only those values are supported.
PostgreSQL uses own timezone implementation, but we cannot use it from an external program.
</dd>

<dt>Error messages in fast or immediate shutdown</dt>
<dd>Those error messages are not avoidable on PostgreSQL shutdown unless it is a smart shutdown.
</dd>

<dt>Cannot collect shutdown checkpoint logs</dt>
<dd>That't because the repository might be unavailable if it is in the same server with the monitored one.</dd>

<dt>@スナップショット取得とテーブル削除の同時実行</dt>
<dd>@スナップショット取得とテーブル削除が同時に要求されると、タイミングによってはスナップショット取得でエラーが発生する可能性があります。
エラーが発生した場合、スナップショット取得はリトライされます。</dd>

<dt>@複数の監視インスタンスの設定について</dt>
<dd>@各インスタンス毎に、データベースシステム識別子 or OSホスト名 or Port番号のいずれかが異なっていない場合、複数インスタンスとして認識できません。</dd>

<dt>@自動メンテナンス(スナップショット削除)の注意点</dt>
<dd>@複数の監視対象インスタンスのスナップショットを同一のリポジトリDBに蓄積する構成では、
自動メンテナンス設定のスナップショット保持期間の設定に注意してください。<br>
複数の監視対象インスタンスで自動メンテナンスのスナップショット削除を有効とする場合、
それぞれの監視対象インスタンスのスナップショット保持期間の設定でスナップショット削除が実行されます。<br>
そのため、結果的に監視対象インスタンスの中で最も期間の短いスナップショット保持期間が有効となります。</dd>

<dt>@トランザクションログ(WAL)の出力量の統計情報収集に関する制限</dt>
<dd>@監視対象インスタンスがレプリケーション構成のスタンバイの場合は、トランザクションログ(WAL)の出力量の統計情報が収集されません。</dd>

<dt>@レポート全般に関する注意点</dt>
<dd>@データサイズなどを示す一部の項目の値は、単位換算での数値の切り捨てにより微小な値が存在するにもかかわらずゼロと表示される可能性がある。</dd>
</dl>
<br/>

<h2 id="QA">Q&A</h2>
<h4>Q1. How to confirm the method if pg_statsinfo works normal?</h4>
<p>
Pg_statsinfo gets snapshot and stores it in statsrepo schema. 
If you want to confirm if pg_statsinfo waorks normal, you can use under following SQL.
</p>
<pre>
$psql -d postgres -c "SELECT statsinfo.snapshot('test')"
$psql -d postgres -c "SELECT * FROM statsrepo.snapshot WHERE COMMENT = 'test'"
</pre>
<p>If you execute 2nd SQL and get result, pg_statsinfo works normal.</p>

<h4>Q2. How to use snapshots?</h4>
<p>Pg_statsinfo's snapshot function has only getting PostgreSQL's statistics every uniform regularly.
If you want to see useful and visual report from snapshot, you can use <a href='http://pgstatsinfo.projects.postgresql.org/pg_stats_reporter.html'>pg_stats_reporter</a>. 
Example of pg_repoter's output report is <a href='files/details.html'>here</a>.
</p>

<h4>Q3. Auto maintenance mode does not work well. </h4>
<p>
@自動メンテナンスの設定が有効になっていないことが考えられます。
以下の事項を点検してください。
</p>

<dl>
  <dt>@自動メンテナンスの設定が、postgresql.conf に適切に記述されているか</dt>
  <dd>postgresql.conf の自動メンテナンス設定が 'on' または 'snapshot' が含まれているか確認してください。
    <ul>
      <li>pg_statsinfo.enable_maintenance = 'on'</li>
      <li>pg_statsinfo.enable_maintenance = 'snapshot'</li>
      <li>pg_statsinfo.enable_maintenance = 'snapshot, log'</li>
    </ul>
  </dd>
</dl>

<h4>@Q4. アラート機能が正常に動作しているかの確認方法を教えてください。</h4>
<p>
@アラート機能を有効に設定、かつ秒間コミット数のアラート条件(閾値)を「0」に設定した状態でスナップショットを取得してください。<br>
スナップショットの取得時に、サーバログにアラートメッセージが出力されていればアラート機能が正常に動作しています。
</p>

<p>
@アラート機能を有効、かつ秒間のコミット数のアラート条件(閾値)を「0」に設定するには以下の SQL をリポジトリDBに対して実行します。
</p>
<pre>
# UPDATE statsrepo.alert SET enable_alert = true, commit_tps = 0;
</pre>

<p>
@アラート機能が正常に動作したことを確認した後は、秒間のコミット数のアラート条件(閾値)を元に戻してください。
</p>

<h4>@Q5. 古いバージョン(2.x)からアップグレードする方法を教えてください。</h4>
<p>
@古いバージョンをアンインストールした後、新しいバージョンをインストールしてください。<br>
また、古いバージョンで取得済みのスナップショットは新しいバージョンでは利用できません。<br>
<a href="#uninstall">アンインストール</a> の手順に従い、リポジトリDBのスナップショットを全て削除してください。<br><br>
上記の操作を行った後、監視対象インスタンスを再起動してください。
</p>

<h4>@Q6. 簡易レポート機能でレポート生成を実行したところ、レポートが表示されません。</h4>
<p>
@リポジトリDBに格納されているスナップショットの件数が2件未満である可能性があります。<br>
レポートの作成には2件以上のスナップショットが必要となりますので、スナップショットの取得が2回実行されるのを待ってからレポート生成を実行してください。
</p>

<h4>@Q7. 簡易レポート機能でレポート生成を実行したところ、一部のレポート項目が表示されません。</h4>
<dl>
  <dt>Query Activity (Functions)</dt>
  <dd>@設定ファイルの「track_functions」が「none」に設定されている可能性があります。</dd>
  <dd>@この場合、当該レポート項目に必要な情報がスナップショットに含まれません。</dd>
  <dd>@当該レポート項目を表示するには「track_functions」を「none」以外に設定してください。</dd>
  
  <dt>Query Activity (Statements)</dt>
  <dd>@pg_stat_statements がインストールされていない可能性があります。</dd>
  <dd>@この場合、当該レポート項目に必要な情報がスナップショットに含まれません。</dd>
  <dd>@当該レポート項目を表示するには pg_stat_statements をインストールしてください。</dd>
  
  <dt>Autovacuum Activity</dt>
  <dd>@設定ファイルの「log_autovacuum_min_duration」が「-1」に設定されている可能性があります。</dd>
  <dd>@この場合、当該レポート項目に必要な情報がスナップショットに含まれません。</dd>
  <dd>@当該レポート項目を表示するには「log_autovacuum_min_duration」を「-1」以外に設定してください。</dd>
  
  <dt>Checkpoint Activity</dt>
  <dd>@設定ファイルの「log_checkpoints」が「off」に設定されている可能性があります。</dd>
  <dd>@この場合、当該レポート項目に必要な情報がスナップショットに含まれません。</dd>
  <dd>@当該レポート項目を表示するには「log_checkpoints」を「on」に設定してください。</dd>
  
  <dt>OS Resource Usage (IO Usage)</dt>
  <dd>@OS管理外の記憶デバイスまたは分散ファイルシステム(NFSなど)を利用した環境では、OSリソースのディスクI/O情報が収集されません。</dd>
  <dd>@そのため、当該レポート項目に必要な情報がスナップショットに存在しない可能性があります。</dd>
  
  <dt>Long Transactions</dt>
  <dd>@レポート対象となる情報がスナップショットに存在しない可能性があります。</dd>
  
  <dt>Notable Tables</dt>
  <dd>@レポート対象となる情報がスナップショットに存在しない可能性があります。</dd>
  
  <dt>Lock Conflicts</dt>
  <dd>@レポート対象となる情報がスナップショットに存在しない可能性があります。</dd>
  
  <dt>Replication Activity</dt>
  <dd>@レポート対象となる情報がスナップショットに存在しない可能性があります。</dd>
  
  <dt>Schema Information</dt>
  <dd>@一部のデータベースのスキーマ情報が含まれてない場合は、該当のデータベースに接続できる設定になっているか <a href="http://www.postgresql.jp/document/current/html/client-authentication.html">クライアント認証</a> などを確認してください。</dd>
</dl>
<br>

<h2 id="change">@pg_statsinfo 2.4 からの変更点</h2>
<p>@pg_statsinfo 2.4 からの変更点は以下の通りです。</p>
<ul>
  <li>@PostgreSQL 9.3に対応</li>
  <li>@統計情報の収集対象に以下の項目を追加</li>
  <ul>
    <li>@バックエンドの最大数</li>
    <li>@PostgreSQLの設定パラメータの単位</li>
  </ul>
  <li>@テキストログファイル名の設定のデフォルト値を "pg_statsinfo.log" に変更</li>
  <li>@アラート機能の実行有無をアラート項目単位で切り替える設定を追加</li>
  <li>@アラート機能の判定対象に以下の項目を追加</li>
  <ul>
    <li>@テーブルの断片化率(correlation)</li>
    <li>@バックエンドの最大数</li>
    <li>@テーブルスペースのディスク空き容量</li>
    <li>@ロードアベレージ</li>
    <li>@スワップ使用量</li>
    <li>@レプリケーションの遅延量</li>
  </ul>
  <li>@チェックポイントおよび自動バキュームのログがサーバログのフィルタリングで分配されるように変更</li>
  <li>@スタンバイで実行されたチェックポイント(リスタートポイント)の統計情報を収集するように変更</li>
  <li>@リポジトリDBに不備がある場合は、フォールバックモード(一部機能を無効化した状態)で動作するように変更</li>
  <li>@簡易レポート機能の名称をコマンドライン機能に変更</li>
  <li>@コマンドライン機能が生成するレポートに以下の項目を追加</li>
  <ul>
    <li>@レプリケーションの遅延量</li>
    <li>@Autoanalyzeの実行回数と処理時間</li>
    <li>@データベース設定のパラメータの単位</li>
  </ul>
  <li>@コマンドライン機能が提供する操作に以下の項目を追加</li>
  <ul>
    <li>@エージェント停止</li>
    <li>@エージェント起動</li>
  </ul>
</ul>
<br>

<h2 id="details">Details</h2>
<p>More advanced usages and internal structures are explained in the section.</p>

<h3 id="many-instances">Multiple Instance and One Repository System</h3>
<p>
We can set Multiple instance and One Repository system.
If you want to set the systems, you set following parameter in each instance and <a href='http://www.postgresql.org/docs/current/static/auth-methods.html'>less password setting in repository</a>.
</p>

<pre>pg_statsinfo.repository_server = 'hostaddr=192.168.0.32 port=5432 user=postgres dbname=postgres'</pre>

<h3 id="warm-standby">Warm Standby</h3>
<p><a href="http://developer.postgresql.org/pgdocs/postgres/warm-standby.html">Warm standby</a> can be used together with pg_statsinfo.
There are two typical setups for warm standby mode.
See also "<a href="pg_statsinfo-warm-standby.html">pg_statsinfo: warm-standby</a>" for details.
</p>

<ol>
  <li>Setup another repository server independent from active and standby servers.</li>
  <li>Place repositories for each active and standby servers.</li>
</ol>

<h3 id="fallback-mode">@フォールバックモード</h3>
<p>@エージェント起動時および設定リロード時にリポジトリDBの正当性チェックを行います。<br/>
正当性チェックを実施した結果、不備が検出された場合は一部の機能を無効化した状態で動作するモード(フォールバックモード)に移行します。</p>

<p>@リポジトリDBの正当性チェックの内容およびフォールバックモードで無効化される機能を以下に示します。</p>
<h4>@リポジトリDBの正当性チェックの内容</h4>
<ul>
  <li>@リポジトリDBに接続できるか</li>
  <li>@リポジトリDBに登録されている statsrepo スキーマのバージョンが正しいか</li>
  <li>@リポジトリDBの PostgreSQL が XML をサポートしているか (configure オプションに --with-libxml が指定されたビルドであるか)</li>
</ul>

<h4>@フォールバックモードで無効化される機能</h4>
<ul>
  <li>@統計情報の取得機能</li>
  <li>@アラート機能</li>
  <li>@コマンドライン機能でのスナップショット取得</li>
  <li>@自動メンテナンス機能でのスナップショット削除</li>
</ul>

<h4>@復旧手順</h4>
<p>@リポジトリDBに接続できないことが原因でフォールバックモードの移行した場合は、リポジトリDBを復旧した時点で自動的に通常モードに復旧します。<br/>
他の原因によりフォールバックモードに移行した場合は、リポジトリDBを復旧した後で設定リロードを実行してください。</p>

<p>@フォールバックモードに移行した原因はログ(テキストログ or syslog)に出力された内容から判断できます。<br/>
フォールバックモードに移行した時のログの出力例を以下に示します。</p>
<pre>
# @リポジトリDBに接続できない
ERROR:  pg_statsinfo: could not connect to database with "host=192.168.0.1 user=postgres": timeout expired
LOG:  pg_statsinfo: pg_statsinfo is starting in fallback mode

# @statsrepo スキーマのバージョンが合わない
ERROR:  pg_statsinfo: incompatible statsrepo schema: version mismatch
LOG:  pg_statsinfo: pg_statsinfo is starting in fallback mode

# @リポジトリDBの PostgreSQL が XML をサポートしていない
ERROR:  pg_statsinfo: repository server must support XML feature. you need to rebuild PostgreSQL using "./configure --with-libxml"
LOG:  pg_statsinfo: pg_statsinfo is starting in fallback mode
</pre>

<p>@リポジトリDBの復旧に関する点検事項と対処方法を以下に示します。</p>
<dl>
  <dt>@リポジトリDBに接続できない場合</dt>
  <ul>
    <li>@リポジトリDBの稼動状態を確認し、リポジトリDBが停止している場合はリポジトリDBを起動してください。</li>
    <li>@設定ファイルのリポジトリDBへの接続文字列(pg_statsinfo.repository_server)を確認し、設定が誤っている場合は修正してください。(要設定リロード)</li>
  </ul>
  <dt>@statsrepo スキーマのバージョンが合わない場合</dt>
  <ul>
    <li>@statsrepo スキーマを削除するか、リポジトリDBのデータベースを別に作成してください。</li>
  </ul>
  <dd>@(正しいバージョンの statsrepo スキーマは設定リロード時に自動的に登録されます)</dd>
  <dt>@PostgreSQL が XML をサポートしていない場合</dt>
  <ul>
    <li>@configure オプションに --with-libxml が指定されたビルドの PostgreSQL をインストールした後、リポジトリDBを再起動してください。</li>
  </ul>
</dl>

<h3 id="internal">Internals</h3>
<p>pg_statsinfo consists of a library and a daemon. The library is loaded by PostgreSQL server, and the daemon is run as a database client.
Since the daemon is executed from a hook function in the library, users don't have to execute the daemon explicitly.
See also "<a href="pg_statsinfo-internal.html">pg_statsinfo: internal</a>" for details.
</p>

<h2 id="seealso">See Also</h2>
<a href="http://developer.postgresql.org/pgdocs/postgres/app-pg-ctl.html">pg_ctl</a>,
<a href="http://developer.postgresql.org/pgdocs/postgres/app-psql.html">psql</a>,
<a href="http://developer.postgresql.org/pgdocs/postgres/runtime-config.html">Server Configuration</a>,
<a href="http://developer.postgresql.org/pgdocs/postgres/monitoring-stats.html">The Statistics Collector</a>,
<a href="http://developer.postgresql.org/pgdocs/postgres/catalogs.html">System Catalogs</a>,
<a href="http://developer.postgresql.org/pgdocs/postgres/pgstatstatements.html">pg_stat_statements</a>,
<a href="http://pgstatsinfo.projects.postgresql.org/pg_stats_reporter.html">pg_stats_reporter</a>

<hr />
<div class="navigation">
  <a href="index.html">Top</a> &gt;
  <a href="pg_statsinfo.html">pg_statsinfo</a>
<div>
<p class="footer">Copyright (c) 2009-2013, NIPPON TELEGRAPH AND TELEPHONE CORPORATION</p>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-10244036-6");
pageTracker._trackPageview();
} catch(err) {}
</script>
</body>
</html>

<style type="text/css">
div.imagebox {
float: left;
text-align: center;
margin: 0.5em 3px 1em 3px;
}
p.image, p.caption {
text-align: center;
margin: 5px;
}
p.caption {
font-size: 16px;
color: #000000;
}
p.clear {
clear: both;
}
</style>
